apiVersion: kubescheduler.config.k8s.io/v1alpha2
kind: KubeSchedulerConfiguration
leaderElection:
  leaderElect: false
clientConnection:
  #kubeconfig: "REPLACE_ME_WITH_KUBE_CONFIG_PATH" #not-required, will use in-cluster config (default API)

profiles:
# Profile 1: Default scheduler with all KubeNexus plugins
- schedulerName: default-scheduler
  plugins:
    queueSort:
      enabled:
        - name: Coscheduling
      disabled:
        - name: "*"

# Profile 2: KubeNexus scheduler with full feature set
- schedulerName: kubenexus-scheduler
  plugins:
    # Queue sorting - prioritize gang scheduling
    queueSort:
      enabled:
        - name: Coscheduling
      disabled:
        - name: "*"
    
    # PreFilter - early validation for gang scheduling
    preFilter:
      enabled:
        - name: Coscheduling
        - name: ResourceReservation  # Creates capacity reservations for gangs
    
    # Filter - node feasibility checks
    filter:
      enabled:
        - name: Coscheduling
        - name: ResourceReservation  # Checks reserved capacity
        - name: NUMATopology            # NUMA-aware filtering for ML/batch workloads
      disabled:
        - name: "*"
    
    # PreScore - prepare for scoring
    preScore:
      enabled:
        - name: Coscheduling
    
    # Score - workload-aware node scoring
    score:
      enabled:
        - name: WorkloadAwareScoring   # Adaptive: bin packing for batch, spreading for services
        - name: BackfillScoring         # Opportunistic: fills idle capacity with low-priority pods
        - name: NUMATopology            # NUMA-aware scoring for optimal memory bandwidth
        - name: TopologySpreadScoring   # Zone-aware spreading for high availability
        - name: Coscheduling            # Gang scheduling preferences
      disabled:
        - name: "*"
    
    # Reserve - resource reservation
    reserve:
      enabled:
        - name: Coscheduling
        - name: ResourceReservation  # Prevents resource starvation
    
    # Unreserve - cleanup on scheduling failure
    unreserve:
      enabled:
        - name: Coscheduling
        - name: ResourceReservation
    
    # Permit - delay scheduling until gang is ready
    permit:
      enabled:
        - name: Coscheduling
    
    # PostFilter - gang-aware preemption
    postFilter:
      enabled:
        - name: GangPreemption       # Preempts lower priority gang pods
    
    # PreBind - final checks before binding
    preBind:
      enabled:
        - name: Coscheduling
    
    # Bind - pod to node binding
    bind:
      enabled:
        - name: Coscheduling
      disabled:
        - name: "*"
    
    # PostBind - cleanup and state updates
    postBind:
      enabled:
        - name: Coscheduling
        - name: ResourceReservation  # Cleans up reservations when gang completes

# Profile 3: Gang scheduler (legacy name for compatibility)
- schedulerName: gang-scheduler
  plugins:
    queueSort:
      enabled:
        - name: Coscheduling
      disabled:
        - name: "*"
    preFilter:
      enabled:
        - name: Coscheduling
        - name: ResourceReservation
    filter:
      enabled:
        - name: Coscheduling
        - name: ResourceReservation
      disabled:
        - name: "*"
    preScore:
      enabled:
        - name: Coscheduling      
    score:
      enabled:
        - name: Coscheduling
      disabled:
        - name: "*"         
    permit:
      enabled:
        - name: Coscheduling
    preBind:
      enabled:
        - name: Coscheduling
    bind:
      enabled:
        - name: Coscheduling
      disabled:
        - name: "*"
    reserve:
      enabled:
        - name: Coscheduling
        - name: ResourceReservation
    unreserve:
      enabled:
        - name: Coscheduling
        - name: ResourceReservation
    postBind:
      enabled:
        - name: Coscheduling
        - name: ResourceReservation
      enabled:
        - name: Coscheduling
        - name: ResourceReservation
