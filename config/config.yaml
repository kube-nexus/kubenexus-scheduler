apiVersion: kubescheduler.config.k8s.io/v1
kind: KubeSchedulerConfiguration
leaderElection:
  leaderElect: true
  resourceName: kubenexus-scheduler
  resourceNamespace: kubenexus-system
clientConnection:
  kubeconfig: ""

profiles:
# Profile 1: Default scheduler with all KubeNexus plugins
- schedulerName: default-scheduler
  plugins:
    queueSort:
      enabled:
        - name: Coscheduling
      disabled:
        - name: "*"

# Profile 2: KubeNexus scheduler with full feature set
- schedulerName: kubenexus-scheduler
  plugins:
    # Queue sorting - prioritize gang scheduling
    queueSort:
      enabled:
        - name: Coscheduling
      disabled:
        - name: "*"
    
    # PreFilter - early validation for gang scheduling
    preFilter:
      enabled:
        - name: Coscheduling
        - name: ResourceReservation  # Creates capacity reservations for gangs
    
    # Filter - node feasibility checks
    filter:
      enabled:
        - name: ResourceReservation  # Checks reserved capacity
        - name: NUMATopology            # NUMA-aware filtering for ML/batch workloads
    
    # PreScore - prepare for scoring
    preScore:
      enabled: []
    
    # Score - workload-aware node scoring
    score:
      enabled:
        - name: WorkloadAwareScoring   # Adaptive: bin packing for batch, spreading for services
        - name: BackfillScoring         # Opportunistic: fills idle capacity with low-priority pods
        - name: NUMATopology            # NUMA-aware scoring for optimal memory bandwidth
        - name: TopologyScoring         # Zone-aware spreading for high availability
    
    # Reserve - resource reservation
    reserve:
      enabled:
        - name: Coscheduling
        - name: ResourceReservation  # Prevents resource starvation
    
    # Permit - delay scheduling until gang is ready
    permit:
      enabled:
        - name: Coscheduling
    
    # PostFilter - gang-aware preemption
    postFilter:
      enabled:
        - name: GangPreemption       # Preempts lower priority gang pods

# Profile 3: Gang scheduler (legacy name for compatibility)
- schedulerName: gang-scheduler
  plugins:
    queueSort:
      enabled:
        - name: Coscheduling
      disabled:
        - name: "*"
    preFilter:
      enabled:
        - name: Coscheduling
        - name: ResourceReservation
    filter:
      enabled:
        - name: ResourceReservation
    reserve:
      enabled:
        - name: Coscheduling
        - name: ResourceReservation         
    permit:
      enabled:
        - name: Coscheduling
